<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <link href="assets/img/logo/favicon.ico" rel="icon" type="image/x-icon" />
    <title>H2OW LOW</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <!--external css-->
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="assets/css/zabuto_calendar.css">
    <link rel="stylesheet" type="text/css" href="assets/js/gritter/css/jquery.gritter.css" />
    <link rel="stylesheet" type="text/css" href="assets/lineicons/style.css">    
    
    <!-- Custom styles for this template -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/style-responsive.css" rel="stylesheet">

    <link rel="stylesheet" href="assets/fonts/MuseoSans500-Webfont/Webfonts/museosans_500_macroman/stylesheet.css" type="text/css" charset="utf-8" />
    
    <script src="assets/js/chart-master/Chart.js"></script>
    
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <!-- <body style="overflow: auto / hidden"> -->
  <body>

<!--   <section id="container" > -->
      <!-- **********************************************************************************************************************************************************
      TOP BAR CONTENT & NOTIFICATIONS
      *********************************************************************************************************************************************************** -->
      <!--header start-->
      <div class="header top-bar">
            <div class="nav notify-row" id="top_menu">
                <!--  navigation start -->
                <ul class="nav top-menu">
                    <!-- myusage start -->
                    <li>
                        <a href="index.html#" onclick="return get_action(this);" >
                            <img class="top-bar-icon" src="assets/img/icons/blue_person_icon.png"></img>
                        </a>
                    </li>
                    <!-- myusage end -->
                    <!-- friends -->
                    <li>
                        <a href="friends_page1.html#" onclick="return get_action('friends_page1.html#');" > <!-- TODO: change to correct page -->
                            <img class="top-bar-icon" src="assets/img/icons/grey_people_icon.png"></img>
                            <span class="badge bg-theme">3</span>
                        </a>
                    </li>
                    <!-- friends end -->
                    <!-- competition start -->
                    <li>
                        <a href="dorm_competition.html#" onclick="return get_action(this);" > <!-- TODO: change to correct page -->
                            <img class="top-bar-icon" src="assets/img/icons/grey_trophy_icon.png"></img>
                            <span class="badge bg-theme">3</span>
                        </a>
                      </li>
                    <!-- competition end -->
                </ul>
                <!--  navigation end -->
            </div>
            <div class="top-menu">
            	<ul class="nav pull-right top-menu">
                    <li id="header_inbox_bar" class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle">
                          <div class="username" id="username_field">
                            <img class="top-bar-icon" src="assets/img/logo/howlowicon.png"></img>
                            &nbspusername
                          </div>
                        </a>
                        <ul class="dropdown-menu extended">
                            <li>
                                <a href="index.html#" onclick="return get_action(this);">
                                    <span class="message">
                                        my account
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#" onclick="return get_action(this);">
                                    <span class="message">
                                        settings
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://stanford.edu/class/cs147/projects/behavior/h2o_low/">
                                    <span class="message">
                                        about
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="login.html#">
                                    <span class="message">
                                        logout
                                    </span>
                                </a>
                            </li>
                        </ul>
                    </li>
            	</ul>
            </div>
        </div>
      <!--header end-->
      
      
      
      <!-- **********************************************************************************************************************************************************
      MAIN CONTENT
      *********************************************************************************************************************************************************** -->
      <!--main content start-->
      <div id="main-content">
      <!-- <div> -->

        <canvas id="canvas" width="1000" height="600"></canvas>

            <!-- <div class="filler-div"> -->

           <!--  <a href="laundry-usage.html" class="logo">
            <img id="laundrybubble" class="bubble" src="assets/img/bubbles/laundrybubble.png"></img>
            </a>
            
            <a href="sink-usage.html" class="logo">
            <img id="sinkbubble" class="bubble" src="assets/img/bubbles/sinkbubble.png"></img>
            </a>
            
            <a href="toilet-usage.html" class="logo">
            <img id="toiletbubble" class="bubble" src="assets/img/bubbles/toiletbubble.png"></img>
            </a>
            
            <a href="shower-usage.html" class="logo">
            <img id="showerbubble" class="bubble" src="assets/img/bubbles/showerbubble.png"></img>
            </a>
            
            <img class="howlow-logo" src="assets/img/logo/h2owlow.png"></img> -->
            <!-- </div> -->
   

            <!-- <img class="howlow-logo" src="assets/img/logo/h2owlow.png"></img> -->

          <!-- </div> -->


          </div>
      </div>
<img id="laundrybubble" class="bubble" src="assets/img/bubbles/laundrybubble.png"></img>
      <!--main content end-->
      <!--footer start-->
      <!-- <footer class="site-footer">
          <div class="text-center">
              2014 - Alvarez.is
              <a href="index.html#" class="go-top">
                  <i class="fa fa-angle-up"></i>
              </a>
          </div>
      </footer> -->
      <!--footer end-->
  <!-- </section> -->

    <!-- js placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/jquery-1.8.3.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script class="include" type="text/javascript" src="assets/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="assets/js/jquery.scrollTo.min.js"></script>
    <script src="assets/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="assets/js/jquery.sparkline.js"></script>


    <!--common script for all pages-->
    <script src="assets/js/common-scripts.js"></script>
    
    <script type="text/javascript" src="assets/js/gritter/js/jquery.gritter.js"></script>
    <script type="text/javascript" src="assets/js/gritter-conf.js"></script>
	
	  <script type="text/javascript">
        $(document).ready(function () {
        var unique_id = $.gritter.add({
            // (string | mandatory) the heading of the notification
            title: 'Welcome to h2ow low!',
            // (string | mandatory) the text inside the notification
            text: 'Click on a bubble to view your water usage. <br><br>The outer ring represents your average usage level. <br><br>The middle ring shows your all-time low usage. <br><br>Your bubble will grow as you use water.',
            // (string | optional) the image to display on the left
            image: 'assets/img/logo/howlowicon.png',
            // (bool | optional) if you want it to fade out on its own or just sit there
            sticky: false,
            // (int | optional) the time you want it to be alive for before fading out
            time: '6000',
            // (string | optional) the class name you want to apply to that specific message
            class_name: 'gritter-light'
        });

        // <a href="http://blacktie.co" target="_blank" style="color:#ffd777">BlackTie.co</a>

        return false;
        });

	</script>

    <script type="text/javascript">

    $(document).ready(function () {

        var name = getUrlParameter("username");
        $("#username_field").html("<img class=\"top-bar-icon\" src=\"assets/img/logo/howlowicon.png\"></img>&nbsp" + name);
        window.username = name;
        console.log(name);
    });

    function getUrlParameter(sParam) {

        var sPageURL = window.location.search.substring(1);
        var sURLVariables = sPageURL.split('&');
        for (var i = 0; i < sURLVariables.length; i++) 
        {
            var sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] == sParam) 
            {
                return sParameterName[1];
            }
        }
    }  

    function get_action(form) {
            var actionString = form + "?username=" + window.username;
            window.location.href = actionString;
            return false;
        }

    </script>




  <script type="text/javascript">
  $(document).ready(function () {

        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");

        var previousSpeed = 0;
        var firstOrSecondImpact = -1;

        canvas.width = document.body.clientWidth;
        canvas.height = document.body.clientHeight;

        var speed = .5;

        var canvasXmin = 0;
        var canvasYmin = 0; 
        var canvasXmax = canvas.width;
        var canvasYmax = canvas.height;

        var Balls = [];

        //add mouse listeners
        canvas.addEventListener("mousemove", on_mousemove, false);
        canvas.addEventListener("click", on_click, false);

        var currentLink = "";

        // var logo = new Image();
        // logo.src = "assets/img/logo/ho2wlow.png";

        Init();

        function Init() {

            b1 = new Picture();
            b1.sour = 'assets/img/bubbles/laundrybubble.png';
            b1.Xmin = 100;
            b1.Ymin = 10;
            b1.Xdir = 1.5;
            b1.Ydir = 0.3;
            b1.Height = 283;
            b1.Width = 283;
            <!-- b1.pageLink = "file:///Users/nicolascserepy/Desktop/dashgumfree_v2/Theme/laundry-usage.html#" -->
			b1.pageLink = "laundry-usage.html"
            UpdateBallMax(b1);
            Balls.push(b1);


            b2 = new Picture();
            b2.sour = 'assets/img/bubbles/sinkbubble.png';
            b2.Xmin = 1000;
            b2.Ymin = 10;
            b2.Xdir = 0.6;
            b2.Ydir = 0.4;
            b2.Height = 206;
            b2.Width = 206;
           <!--  b2.pageLink = "file:///Users/nicolascserepy/Desktop/dashgumfree_v2/Theme/sink-usage.html#" -->
		    b2.pageLink = "sink-usage.html"
            UpdateBallMax(b2);
            Balls.push(b2);


            var b3 = new Picture();
            b3.sour = 'assets/img/bubbles/showerbubble.png';
            b3.Xmin = 10;
            b3.Ymin = 300;
            b3.Xdir = -1;
            b3.Ydir = -1;
            b3.Height = 325;
            b3.Width = 325;
            <!-- b3.pageLink = "file:///Users/nicolascserepy/Desktop/dashgumfree_v2/Theme/shower-usage.html#" -->
			b3.pageLink = "shower-usage.html"
            UpdateBallMax(b3);
            Balls.push(b3);


            b4 = new Picture();
            b4.sour = 'assets/img/bubbles/toiletbubble.png';
            b4.Xmin = 1000;
            b4.Ymin = 300;
            b4.Xdir = 1;
            b4.Ydir = 1;
            b4.Height = 283;
            b4.Width = 282;
            <!-- b4.pageLink = "file:///Users/nicolascserepy/Desktop/dashgumfree_v2/Theme/toilet-usage.html#" -->
			b4.pageLink = "toilet-usage.html"
            UpdateBallMax(b4);
            Balls.push(b4);


            StartClock();
        }

        function StartClock() {
            setInterval(Game, speed);
        }

        function Game() {
            Logic();
            Draw();
        }

        function Logic() {

            for (var i = 0; i < Balls.length; i++) {
                CheckBallCollision(Balls, i);
                CheckWallCollision(Balls[i]);
            }

            for (var i = 0; i < Balls.length; i++) {

                Balls[i].Xmin = Balls[i].Xmin + 0.25*Balls[i].Xdir;
                Balls[i].Ymin = Balls[i].Ymin + 0.25*Balls[i].Ydir;

                UpdateBallMax(Balls[i]);
            }

        }

        function CheckBallCollision(BallsArray, index) {
            var Ball = BallsArray[index];
            
            for (var i = 0; i < BallsArray.length; i++) {
                if (index != i) {
                    var dx = (Ball.Xmin+Ball.Width/2) - (BallsArray[i].Xmin+BallsArray[i].Width/2);
                    var dy = (Ball.Ymin+Ball.Height/2) - (BallsArray[i].Ymin+BallsArray[i].Height/2);
                    var distance = (dx * dx + dy * dy);

                    if (distance <= (Ball.Width/2 + BallsArray[i].Width/2) * (Ball.Width/2 + BallsArray[i].Width/2)) {
                        collideBalls(BallsArray, index, i);
                    }

                }
            }
        }

        function CheckWallCollision(ball) {
            if ((ball.Xmax > canvasXmax) || (ball.Xmin < canvasXmin)) {
                ball.Xdir = -ball.Xdir; 
            }

            if ((ball.Ymax > 0.92*canvasYmax) || (ball.Ymin < canvasYmin)) { 
                ball.Ydir = -ball.Ydir; 
            }
        }

        function Draw() {
            ClearScreen();

            logo = new Image();
            logo.src = "assets/img/logo/h2owlow.png";
            ctx.drawImage(logo, canvas.width/2-1024/2, canvas.height/2-748/2, 1024, 748);

            for (var i = 0; i < Balls.length; i++) {
                  img = new Image();
                  img.src = Balls[i].sour;
                  ctx.drawImage(img, Balls[i].Xmin, Balls[i].Ymin, Balls[i].Width, Balls[i].Height);
            }

        }

        function adjustSpeeds(ball, x_or_y) {
            if (firstOrSecondImpact == 1) {
                if (x_or_y == "x") {
                    ball.Xdir = previousSpeed;
                } else {
                    ball.Ydir = previousSpeed;
                }
                firstOrSecondImpact *= -1;
            } else {
                if (x_or_y == "x") {
                    previousSpeed = ball.Xdir;
                } else {
                    previousSpeed = ball.Ydir;
                }
                firstOrSecondImpact *= -1;
            }
        }

        function ClearScreen() {
            canvas.height = canvas.height;
        }

        function UpdateBallMax(ball) {
            UpdateBallMaxX(ball);
            UpdateBallMaxY(ball);
        }

        function UpdateBallMaxX(ball) {
            ball.Xmax = ball.Xmin + ball.Width;  // This makes balls bounce off the bottom.
        }

        function UpdateBallMaxY(ball) {
            ball.Ymax = ball.Ymin + ball.Height; //They still bounce without this.
        }

        function Picture() {
            this.sour = "";
            this.pageLink = ""
            this.Xmin = 0; //top left X coord
            this.Ymin = 0; //top left y coord
            this.Height = 250;
            this.Width = 250;
            this.Xmax = this.Xmin + this.Width;
            this.Ymax = this.Ymin + this.Height;
            this.Xdir = 0; // 0 not moving, 1 moving right, -1 moving left
            this.Ydir = 0;
            this.Speed = 1;
        }
        
        //check if the mouse is over the link and change cursor style
        function on_mousemove (ev) {

          var x, y;
          
          // Get the mouse position relative to the canvas element.
          if (ev.layerX || ev.layerX == 0) { 
            x = ev.layerX;
            y = ev.layerY;
          }

          document.body.style.cursor = "";

          //is the mouse over the link?
            for (var i = 0; i < Balls.length; i++) {
              var ball = Balls[i];
              if(x >= ball.Xmin && x <= ball.Xmax && y >= ball.Ymin && y <= ball.Ymax) {
                  document.body.style.cursor = "pointer";
                  currentLink = ball.pageLink;
              } 
            } 

            inLink = false; 

            for (var i = 0; i < Balls.length; i++) {
                var ball = Balls[i];
                if(x >= ball.Xmin && x <= ball.Xmax && y >= ball.Ymin && y <= ball.Ymax) {
                    inLink=true;
              }
            }

        }


        //if the link has been clicked, go to link
        function on_click(e) {

              if (inLink)  {
                window.location = currentLink;
              }

        }

    
    // Updates properties of colliding balls so they appear to bounce off each other.
    // Uses nextX and nextY properties because we don't want to change where they are at the moment.
    function collideBalls(BallsArray, index1, index2) {
      var ball1 = BallsArray[index1];
      var ball2 = BallsArray[index2];
      var dx = ball1.Xmin - ball2.Xmin;
      var dy = ball1.Ymin - ball2.Ymin;
      var collisionAngle = Math.atan2(dy, dx);
      
      // Get velocities of each ball before collision
      var speed1 = Math.sqrt(ball1.Xdir * ball1.Xdir + ball1.Ydir * ball1.Ydir);
      var speed2 = Math.sqrt(ball2.Xdir * ball2.Xdir + ball2.Ydir * ball2.Ydir);
      
      // Get angles (in radians) for each ball, given current velocities
      var direction1 = Math.atan2(ball1.Ydir, ball1.Xdir);
      var direction2 = Math.atan2(ball2.Ydir, ball2.Xdir);
      
      // Rotate velocity vectors so we can plug into equation for conservation of momentum
      var rotatedVelocityX1 = speed1 * Math.cos(direction1 - collisionAngle);
      var rotatedVelocityY1 = speed1 * Math.sin(direction1 - collisionAngle);
      var rotatedVelocityX2 = speed2 * Math.cos(direction2 - collisionAngle);
      var rotatedVelocityY2 = speed2 * Math.sin(direction2 - collisionAngle);
      
      // Update actual velocities using conservation of momentum
      var finalVelocityX1 = ((0) * rotatedVelocityX1 + (2) * rotatedVelocityX2) / (2);
      var finalVelocityX2 = ((2) * rotatedVelocityX1 + (0) * rotatedVelocityX2) / (2);
      
      // // Y velocities remain constant
      var finalVelocityY1 = rotatedVelocityY1;
      var finalVelocityY2 = rotatedVelocityY2;
      
      // Rotate angles back again so the collision angle is preserved
      ball1.Xdir= Math.cos(collisionAngle) * finalVelocityX1 + Math.cos(collisionAngle + Math.PI/2) * rotatedVelocityY1;
      ball1.Ydir = Math.sin(collisionAngle) * finalVelocityX1 + Math.sin(collisionAngle + Math.PI/2) * rotatedVelocityY1;
      ball2.Xdir = Math.cos(collisionAngle) * finalVelocityX2 + Math.cos(collisionAngle + Math.PI/2) * rotatedVelocityY2;
      ball2.Ydir = Math.sin(collisionAngle) * finalVelocityX2 + Math.sin(collisionAngle + Math.PI/2) * rotatedVelocityY2;
      
      // Update nextX and nextY for both balls so we can use them in render() or another collision
      ball1.Xmin += ball1.Xdir;
      ball1.Ymin += ball1.Ydir;
      ball2.Xmin += ball2.Xdir;
      ball2.Ymin += ball2.Ydir;
    }
          

    });
  </script>
  

  </body>
</html>
